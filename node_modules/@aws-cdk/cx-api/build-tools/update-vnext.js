"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/**
 * Load the `features.ts` source file, and replace the "V2NEXT" version markers with the actual current version
 */
const fs_1 = require("fs");
const path = require("path");
const flag_modeling_1 = require("../lib/private/flag-modeling");
async function main() {
    const featuresSourceFile = path.join(__dirname, '..', 'lib', 'features.ts');
    // eslint-disable-next-line @cdklabs/no-invalid-path
    let currentv2 = JSON.parse(await fs_1.promises.readFile(path.join(__dirname, '..', '..', '..', '..', 'version.v2.json'), { encoding: 'utf-8' })).version;
    currentv2 = currentv2?.match(/^[0-9\.]+/)?.[0]; // Make sure to only retain the actual version number, not any '-rc.X' suffix
    if (!currentv2) {
        throw new Error('Could not determine current v2 version number');
    }
    let source = await fs_1.promises.readFile(featuresSourceFile, { encoding: 'utf-8' });
    source = source.replace(new RegExp(flag_modeling_1.MAGIC_V2NEXT, 'g'), currentv2);
    await fs_1.promises.writeFile(featuresSourceFile, source, { encoding: 'utf-8' });
}
main().catch(e => {
    console.error(e);
    process.exitCode = 1;
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXBkYXRlLXZuZXh0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsidXBkYXRlLXZuZXh0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQ0E7O0dBRUc7QUFDSCwyQkFBb0M7QUFDcEMsNkJBQTZCO0FBQzdCLGdFQUE0RDtBQUU1RCxLQUFLLFVBQVUsSUFBSTtJQUNqQixNQUFNLGtCQUFrQixHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsYUFBYSxDQUFDLENBQUM7SUFFNUUsb0RBQW9EO0lBQ3BELElBQUksU0FBUyxHQUF1QixJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sYUFBRSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsaUJBQWlCLENBQUMsRUFBRSxFQUFFLFFBQVEsRUFBRSxPQUFPLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDO0lBQ2xLLFNBQVMsR0FBRyxTQUFTLEVBQUUsS0FBSyxDQUFDLFdBQVcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyw2RUFBNkU7SUFFN0gsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQ2YsTUFBTSxJQUFJLEtBQUssQ0FBQywrQ0FBK0MsQ0FBQyxDQUFDO0lBQ25FLENBQUM7SUFFRCxJQUFJLE1BQU0sR0FBRyxNQUFNLGFBQUUsQ0FBQyxRQUFRLENBQUMsa0JBQWtCLEVBQUUsRUFBRSxRQUFRLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQztJQUMxRSxNQUFNLEdBQUcsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLE1BQU0sQ0FBQyw0QkFBWSxFQUFFLEdBQUcsQ0FBQyxFQUFFLFNBQVMsQ0FBQyxDQUFDO0lBRWxFLE1BQU0sYUFBRSxDQUFDLFNBQVMsQ0FBQyxrQkFBa0IsRUFBRSxNQUFNLEVBQUUsRUFBRSxRQUFRLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQztBQUN4RSxDQUFDO0FBRUQsSUFBSSxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFO0lBQ2YsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNqQixPQUFPLENBQUMsUUFBUSxHQUFHLENBQUMsQ0FBQztBQUN2QixDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIlxuLyoqXG4gKiBMb2FkIHRoZSBgZmVhdHVyZXMudHNgIHNvdXJjZSBmaWxlLCBhbmQgcmVwbGFjZSB0aGUgXCJWMk5FWFRcIiB2ZXJzaW9uIG1hcmtlcnMgd2l0aCB0aGUgYWN0dWFsIGN1cnJlbnQgdmVyc2lvblxuICovXG5pbXBvcnQgeyBwcm9taXNlcyBhcyBmcyB9IGZyb20gJ2ZzJztcbmltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBNQUdJQ19WMk5FWFQgfSBmcm9tICcuLi9saWIvcHJpdmF0ZS9mbGFnLW1vZGVsaW5nJztcblxuYXN5bmMgZnVuY3Rpb24gbWFpbigpIHtcbiAgY29uc3QgZmVhdHVyZXNTb3VyY2VGaWxlID0gcGF0aC5qb2luKF9fZGlybmFtZSwgJy4uJywgJ2xpYicsICdmZWF0dXJlcy50cycpO1xuXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAY2RrbGFicy9uby1pbnZhbGlkLXBhdGhcbiAgbGV0IGN1cnJlbnR2Mjogc3RyaW5nIHwgdW5kZWZpbmVkID0gSlNPTi5wYXJzZShhd2FpdCBmcy5yZWFkRmlsZShwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4nLCAnLi4nLCAnLi4nLCAnLi4nLCAndmVyc2lvbi52Mi5qc29uJyksIHsgZW5jb2Rpbmc6ICd1dGYtOCcgfSkpLnZlcnNpb247XG4gIGN1cnJlbnR2MiA9IGN1cnJlbnR2Mj8ubWF0Y2goL15bMC05XFwuXSsvKT8uWzBdOyAvLyBNYWtlIHN1cmUgdG8gb25seSByZXRhaW4gdGhlIGFjdHVhbCB2ZXJzaW9uIG51bWJlciwgbm90IGFueSAnLXJjLlgnIHN1ZmZpeFxuXG4gIGlmICghY3VycmVudHYyKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdDb3VsZCBub3QgZGV0ZXJtaW5lIGN1cnJlbnQgdjIgdmVyc2lvbiBudW1iZXInKTtcbiAgfVxuXG4gIGxldCBzb3VyY2UgPSBhd2FpdCBmcy5yZWFkRmlsZShmZWF0dXJlc1NvdXJjZUZpbGUsIHsgZW5jb2Rpbmc6ICd1dGYtOCcgfSk7XG4gIHNvdXJjZSA9IHNvdXJjZS5yZXBsYWNlKG5ldyBSZWdFeHAoTUFHSUNfVjJORVhULCAnZycpLCBjdXJyZW50djIpO1xuXG4gIGF3YWl0IGZzLndyaXRlRmlsZShmZWF0dXJlc1NvdXJjZUZpbGUsIHNvdXJjZSwgeyBlbmNvZGluZzogJ3V0Zi04JyB9KTtcbn1cblxubWFpbigpLmNhdGNoKGUgPT4ge1xuICBjb25zb2xlLmVycm9yKGUpO1xuICBwcm9jZXNzLmV4aXRDb2RlID0gMTtcbn0pO1xuIl19