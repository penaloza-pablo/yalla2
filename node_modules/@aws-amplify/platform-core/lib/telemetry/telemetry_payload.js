"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.telemetryPayloadSchema = void 0;
const zod_1 = __importDefault(require("zod"));
const identifiersSchema = zod_1.default.object({
    payloadVersion: zod_1.default.string(),
    sessionUuid: zod_1.default.string(),
    eventId: zod_1.default.string(),
    timestamp: zod_1.default.string(),
    localProjectId: zod_1.default.string(),
    accountId: zod_1.default.string().optional(),
    awsRegion: zod_1.default.string().optional(),
});
const eventSchema = zod_1.default.object({
    state: zod_1.default.enum(['ABORTED', 'FAILED', 'SUCCEEDED']),
    command: zod_1.default.object({
        path: zod_1.default.array(zod_1.default.string()),
        parameters: zod_1.default.array(zod_1.default.string()),
    }),
});
const environmentSchema = zod_1.default.object({
    os: zod_1.default.object({
        platform: zod_1.default.string(),
        release: zod_1.default.string(),
    }),
    shell: zod_1.default.string(),
    npmUserAgent: zod_1.default.string(),
    ci: zod_1.default.boolean(),
    memory: zod_1.default.object({
        total: zod_1.default.number(),
        free: zod_1.default.number(),
    }),
});
const projectSchema = zod_1.default.object({
    dependencies: zod_1.default
        .array(zod_1.default.object({
        name: zod_1.default.string(),
        version: zod_1.default.string(),
    }))
        .optional(),
});
const latencySchema = zod_1.default.object({
    total: zod_1.default.number(),
    init: zod_1.default.number().optional(),
    synthesis: zod_1.default.number().optional(),
    deployment: zod_1.default.number().optional(),
    hotSwap: zod_1.default.number().optional(),
});
const errorSchema = zod_1.default.lazy(() => zod_1.default.object({
    name: zod_1.default.string(),
    // Purposely omitting message and stack. Removing them from the Zod schema
    // removes them from the payload sent to the server.
    // message: z.string(),
    // stack: z.string(),
    caused: zod_1.default.optional(errorSchema), // Recursive reference
}));
exports.telemetryPayloadSchema = zod_1.default.object({
    identifiers: identifiersSchema,
    event: eventSchema,
    environment: environmentSchema,
    project: projectSchema,
    latency: latencySchema,
    error: zod_1.default.optional(errorSchema),
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVsZW1ldHJ5X3BheWxvYWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdGVsZW1ldHJ5L3RlbGVtZXRyeV9wYXlsb2FkLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLDhDQUFvQjtBQUVwQixNQUFNLGlCQUFpQixHQUFHLGFBQUMsQ0FBQyxNQUFNLENBQUM7SUFDakMsY0FBYyxFQUFFLGFBQUMsQ0FBQyxNQUFNLEVBQUU7SUFDMUIsV0FBVyxFQUFFLGFBQUMsQ0FBQyxNQUFNLEVBQUU7SUFDdkIsT0FBTyxFQUFFLGFBQUMsQ0FBQyxNQUFNLEVBQUU7SUFDbkIsU0FBUyxFQUFFLGFBQUMsQ0FBQyxNQUFNLEVBQUU7SUFDckIsY0FBYyxFQUFFLGFBQUMsQ0FBQyxNQUFNLEVBQUU7SUFDMUIsU0FBUyxFQUFFLGFBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxRQUFRLEVBQUU7SUFDaEMsU0FBUyxFQUFFLGFBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxRQUFRLEVBQUU7Q0FDakMsQ0FBQyxDQUFDO0FBRUgsTUFBTSxXQUFXLEdBQUcsYUFBQyxDQUFDLE1BQU0sQ0FBQztJQUMzQixLQUFLLEVBQUUsYUFBQyxDQUFDLElBQUksQ0FBQyxDQUFDLFNBQVMsRUFBRSxRQUFRLEVBQUUsV0FBVyxDQUFDLENBQUM7SUFDakQsT0FBTyxFQUFFLGFBQUMsQ0FBQyxNQUFNLENBQUM7UUFDaEIsSUFBSSxFQUFFLGFBQUMsQ0FBQyxLQUFLLENBQUMsYUFBQyxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQ3pCLFVBQVUsRUFBRSxhQUFDLENBQUMsS0FBSyxDQUFDLGFBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQztLQUNoQyxDQUFDO0NBQ0gsQ0FBQyxDQUFDO0FBRUgsTUFBTSxpQkFBaUIsR0FBRyxhQUFDLENBQUMsTUFBTSxDQUFDO0lBQ2pDLEVBQUUsRUFBRSxhQUFDLENBQUMsTUFBTSxDQUFDO1FBQ1gsUUFBUSxFQUFFLGFBQUMsQ0FBQyxNQUFNLEVBQUU7UUFDcEIsT0FBTyxFQUFFLGFBQUMsQ0FBQyxNQUFNLEVBQUU7S0FDcEIsQ0FBQztJQUNGLEtBQUssRUFBRSxhQUFDLENBQUMsTUFBTSxFQUFFO0lBQ2pCLFlBQVksRUFBRSxhQUFDLENBQUMsTUFBTSxFQUFFO0lBQ3hCLEVBQUUsRUFBRSxhQUFDLENBQUMsT0FBTyxFQUFFO0lBQ2YsTUFBTSxFQUFFLGFBQUMsQ0FBQyxNQUFNLENBQUM7UUFDZixLQUFLLEVBQUUsYUFBQyxDQUFDLE1BQU0sRUFBRTtRQUNqQixJQUFJLEVBQUUsYUFBQyxDQUFDLE1BQU0sRUFBRTtLQUNqQixDQUFDO0NBQ0gsQ0FBQyxDQUFDO0FBRUgsTUFBTSxhQUFhLEdBQUcsYUFBQyxDQUFDLE1BQU0sQ0FBQztJQUM3QixZQUFZLEVBQUUsYUFBQztTQUNaLEtBQUssQ0FDSixhQUFDLENBQUMsTUFBTSxDQUFDO1FBQ1AsSUFBSSxFQUFFLGFBQUMsQ0FBQyxNQUFNLEVBQUU7UUFDaEIsT0FBTyxFQUFFLGFBQUMsQ0FBQyxNQUFNLEVBQUU7S0FDcEIsQ0FBQyxDQUNIO1NBQ0EsUUFBUSxFQUFFO0NBQ2QsQ0FBQyxDQUFDO0FBRUgsTUFBTSxhQUFhLEdBQUcsYUFBQyxDQUFDLE1BQU0sQ0FBQztJQUM3QixLQUFLLEVBQUUsYUFBQyxDQUFDLE1BQU0sRUFBRTtJQUNqQixJQUFJLEVBQUUsYUFBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLFFBQVEsRUFBRTtJQUMzQixTQUFTLEVBQUUsYUFBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLFFBQVEsRUFBRTtJQUNoQyxVQUFVLEVBQUUsYUFBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLFFBQVEsRUFBRTtJQUNqQyxPQUFPLEVBQUUsYUFBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLFFBQVEsRUFBRTtDQUMvQixDQUFDLENBQUM7QUFXSCxNQUFNLFdBQVcsR0FBNEIsYUFBQyxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FDdkQsYUFBQyxDQUFDLE1BQU0sQ0FBQztJQUNQLElBQUksRUFBRSxhQUFDLENBQUMsTUFBTSxFQUFFO0lBQ2hCLDBFQUEwRTtJQUMxRSxvREFBb0Q7SUFDcEQsdUJBQXVCO0lBQ3ZCLHFCQUFxQjtJQUNyQixNQUFNLEVBQUUsYUFBQyxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsRUFBRSxzQkFBc0I7Q0FDeEQsQ0FBQyxDQUNILENBQUM7QUFFVyxRQUFBLHNCQUFzQixHQUFHLGFBQUMsQ0FBQyxNQUFNLENBQUM7SUFDN0MsV0FBVyxFQUFFLGlCQUFpQjtJQUM5QixLQUFLLEVBQUUsV0FBVztJQUNsQixXQUFXLEVBQUUsaUJBQWlCO0lBQzlCLE9BQU8sRUFBRSxhQUFhO0lBQ3RCLE9BQU8sRUFBRSxhQUFhO0lBQ3RCLEtBQUssRUFBRSxhQUFDLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQztDQUMvQixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeiBmcm9tICd6b2QnO1xuXG5jb25zdCBpZGVudGlmaWVyc1NjaGVtYSA9IHoub2JqZWN0KHtcbiAgcGF5bG9hZFZlcnNpb246IHouc3RyaW5nKCksXG4gIHNlc3Npb25VdWlkOiB6LnN0cmluZygpLFxuICBldmVudElkOiB6LnN0cmluZygpLFxuICB0aW1lc3RhbXA6IHouc3RyaW5nKCksXG4gIGxvY2FsUHJvamVjdElkOiB6LnN0cmluZygpLFxuICBhY2NvdW50SWQ6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgYXdzUmVnaW9uOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG59KTtcblxuY29uc3QgZXZlbnRTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIHN0YXRlOiB6LmVudW0oWydBQk9SVEVEJywgJ0ZBSUxFRCcsICdTVUNDRUVERUQnXSksXG4gIGNvbW1hbmQ6IHoub2JqZWN0KHtcbiAgICBwYXRoOiB6LmFycmF5KHouc3RyaW5nKCkpLFxuICAgIHBhcmFtZXRlcnM6IHouYXJyYXkoei5zdHJpbmcoKSksXG4gIH0pLFxufSk7XG5cbmNvbnN0IGVudmlyb25tZW50U2NoZW1hID0gei5vYmplY3Qoe1xuICBvczogei5vYmplY3Qoe1xuICAgIHBsYXRmb3JtOiB6LnN0cmluZygpLFxuICAgIHJlbGVhc2U6IHouc3RyaW5nKCksXG4gIH0pLFxuICBzaGVsbDogei5zdHJpbmcoKSxcbiAgbnBtVXNlckFnZW50OiB6LnN0cmluZygpLFxuICBjaTogei5ib29sZWFuKCksXG4gIG1lbW9yeTogei5vYmplY3Qoe1xuICAgIHRvdGFsOiB6Lm51bWJlcigpLFxuICAgIGZyZWU6IHoubnVtYmVyKCksXG4gIH0pLFxufSk7XG5cbmNvbnN0IHByb2plY3RTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIGRlcGVuZGVuY2llczogelxuICAgIC5hcnJheShcbiAgICAgIHoub2JqZWN0KHtcbiAgICAgICAgbmFtZTogei5zdHJpbmcoKSxcbiAgICAgICAgdmVyc2lvbjogei5zdHJpbmcoKSxcbiAgICAgIH0pLFxuICAgIClcbiAgICAub3B0aW9uYWwoKSxcbn0pO1xuXG5jb25zdCBsYXRlbmN5U2NoZW1hID0gei5vYmplY3Qoe1xuICB0b3RhbDogei5udW1iZXIoKSxcbiAgaW5pdDogei5udW1iZXIoKS5vcHRpb25hbCgpLFxuICBzeW50aGVzaXM6IHoubnVtYmVyKCkub3B0aW9uYWwoKSxcbiAgZGVwbG95bWVudDogei5udW1iZXIoKS5vcHRpb25hbCgpLFxuICBob3RTd2FwOiB6Lm51bWJlcigpLm9wdGlvbmFsKCksXG59KTtcblxuZXhwb3J0IHR5cGUgRXJyb3JEZXRhaWxzID0ge1xuICBuYW1lOiBzdHJpbmc7XG4gIC8vIFB1cnBvc2VseSBvbWl0dGluZyBtZXNzYWdlIGFuZCBzdGFjay4gUmVtb3ZpbmcgdGhlbSBmcm9tIHRoZSBab2Qgc2NoZW1hXG4gIC8vIHJlbW92ZXMgdGhlbSBmcm9tIHRoZSBwYXlsb2FkIHNlbnQgdG8gdGhlIHNlcnZlci5cbiAgLy8gbWVzc2FnZTogc3RyaW5nO1xuICAvLyBzdGFjazogc3RyaW5nO1xuICBjYXVzZWQ/OiBFcnJvckRldGFpbHM7XG59O1xuXG5jb25zdCBlcnJvclNjaGVtYTogei5ab2RUeXBlPEVycm9yRGV0YWlscz4gPSB6LmxhenkoKCkgPT5cbiAgei5vYmplY3Qoe1xuICAgIG5hbWU6IHouc3RyaW5nKCksXG4gICAgLy8gUHVycG9zZWx5IG9taXR0aW5nIG1lc3NhZ2UgYW5kIHN0YWNrLiBSZW1vdmluZyB0aGVtIGZyb20gdGhlIFpvZCBzY2hlbWFcbiAgICAvLyByZW1vdmVzIHRoZW0gZnJvbSB0aGUgcGF5bG9hZCBzZW50IHRvIHRoZSBzZXJ2ZXIuXG4gICAgLy8gbWVzc2FnZTogei5zdHJpbmcoKSxcbiAgICAvLyBzdGFjazogei5zdHJpbmcoKSxcbiAgICBjYXVzZWQ6IHoub3B0aW9uYWwoZXJyb3JTY2hlbWEpLCAvLyBSZWN1cnNpdmUgcmVmZXJlbmNlXG4gIH0pLFxuKTtcblxuZXhwb3J0IGNvbnN0IHRlbGVtZXRyeVBheWxvYWRTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIGlkZW50aWZpZXJzOiBpZGVudGlmaWVyc1NjaGVtYSxcbiAgZXZlbnQ6IGV2ZW50U2NoZW1hLFxuICBlbnZpcm9ubWVudDogZW52aXJvbm1lbnRTY2hlbWEsXG4gIHByb2plY3Q6IHByb2plY3RTY2hlbWEsXG4gIGxhdGVuY3k6IGxhdGVuY3lTY2hlbWEsXG4gIGVycm9yOiB6Lm9wdGlvbmFsKGVycm9yU2NoZW1hKSxcbn0pO1xuXG5leHBvcnQgdHlwZSBUZWxlbWV0cnlQYXlsb2FkID0gei5pbmZlcjx0eXBlb2YgdGVsZW1ldHJ5UGF5bG9hZFNjaGVtYT47XG5cbmV4cG9ydCB0eXBlIFRlbGVtZXRyeVBheWxvYWRLZXlzID0ga2V5b2YgVGVsZW1ldHJ5UGF5bG9hZDtcbiJdfQ==